<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Chromium å·¥ä½œåŸç†å¯è§†åŒ–</title>  
    <style>  
        body {  
            margin: 0;  
            background-color: #1e272e;  
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;  
            color: white;  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            min-height: 100vh;  
        }  
  
        h1 { margin-top: 20px; font-weight: 300; }  
  
        /* æ§åˆ¶æ  */  
        .controls {  
            margin: 20px;  
            background: rgba(255, 255, 255, 0.1);  
            padding: 15px 30px;  
            border-radius: 30px;  
            display: flex;  
            gap: 20px;  
            align-items: center;  
        }  
  
        button {  
            padding: 10px 30px;  
            background: #0984e3;  
            color: white;  
            border: none;  
            border-radius: 20px;  
            cursor: pointer;  
            font-size: 16px;  
            font-weight: bold;  
            transition: 0.2s;  
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);  
        }  
  
        button:hover { background: #74b9ff; transform: translateY(-2px); }  
        button:disabled { background: #555; cursor: not-allowed; transform: none; }  
  
        /* ä¸»èˆå° */  
        .stage {  
            position: relative;  
            width: 1000px;  
            height: 600px;  
            background: #2d3436;  
            border-radius: 15px;  
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);  
            overflow: hidden;  
        }  
  
        /* è¿›ç¨‹ç›’å­æ ·å¼ */  
        .process-box {  
            position: absolute;  
            border-radius: 10px;  
            padding: 10px;  
            border: 2px solid rgba(255,255,255,0.2);  
            background: rgba(0,0,0,0.2);  
            transition: all 0.3s;  
        }  
        .process-title {  
            position: absolute;  
            top: -30px;  
            left: 0;  
            font-size: 14px;  
            font-weight: bold;  
            color: #aaa;  
            text-transform: uppercase;  
            letter-spacing: 1px;  
        }  
  
        /* å…·ä½“è¿›ç¨‹ä½ç½® */  
        #browser-process { top: 50px; left: 50px; width: 250px; height: 200px; border-color: #0984e3; }  
        #network-service { top: 300px; left: 50px; width: 250px; height: 100px; border-color: #e17055; border-style: dashed; }  
        #renderer-process { top: 50px; left: 400px; width: 550px; height: 350px; border-color: #00b894; }  
        #gpu-process { top: 450px; left: 400px; width: 550px; height: 100px; border-color: #6c5ce7; }  
  
        /* å†…éƒ¨ç»„ä»¶ */  
        .component {  
            position: absolute;  
            background: rgba(255,255,255,0.1);  
            border-radius: 5px;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            font-size: 12px;  
            color: #ddd;  
            text-align: center;  
        }  
  
        /* æµè§ˆå™¨è¿›ç¨‹ç»„ä»¶ */  
        .ui-thread { top: 40px; left: 20px; width: 210px; height: 40px; background: #0984e3; }  
        .storage { top: 100px; left: 20px; width: 210px; height: 40px; }  
  
        /* æ¸²æŸ“è¿›ç¨‹ç»„ä»¶ */  
        .main-thread { top: 40px; left: 20px; width: 510px; height: 180px; border: 1px solid #00b894; background: transparent; }  
        .compositor-thread { top: 240px; left: 20px; width: 240px; height: 90px; background: #00b894; opacity: 0.2; }  
        .raster-thread { top: 240px; left: 280px; width: 240px; height: 90px; background: #00b894; opacity: 0.2; }  
  
        /* æ¸²æŸ“æµæ°´çº¿èŠ‚ç‚¹ */  
        .pipeline-node {  
            position: absolute;  
            width: 80px;  
            height: 60px;  
            background: #444;  
            border-radius: 5px;  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            justify-content: center;  
            font-size: 10px;  
            opacity: 0.3;  
            transition: 0.3s;  
        }  
        .pipeline-node span { font-size: 16px; margin-bottom: 5px; }  
  
        #node-html { top: 80px; left: 40px; }  
        #node-style { top: 80px; left: 140px; }  
        #node-layout { top: 80px; left: 240px; }  
        #node-paint { top: 80px; left: 340px; }  
        #node-layer { top: 80px; left: 440px; }  
  
        /* è¿çº¿ SVG */  
        svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }  
        .connection { stroke: #555; stroke-width: 2; fill: none; }  
          
        /* æ•°æ®åŒ…åŠ¨ç”» */  
        .packet {  
            position: absolute;  
            width: 12px;  
            height: 12px;  
            background: #fff;  
            border-radius: 50%;  
            box-shadow: 0 0 10px #fff;  
            opacity: 0;  
            z-index: 10;  
        }  
  
        .packet.url { background: #ffeaa7; }  
        .packet.html { background: #55efc4; }  
        .packet.tile { background: #a29bfe; width: 20px; height: 20px; border-radius: 2px; }  
  
        /* çŠ¶æ€æç¤º */  
        #status-bar {  
            margin-top: 10px;  
            font-size: 18px;  
            color: #fab1a0;  
            height: 30px;  
        }  
  
        /* é«˜äº®åŠ¨ç”» */  
        .active-component {  
            box-shadow: 0 0 15px rgba(255,255,255,0.5);  
            background: rgba(255,255,255,0.2) !important;  
            opacity: 1 !important;  
            transform: scale(1.05);  
        }  
  
    </style>  
</head>  
<body>  
  
    <h1>Chromium æ¸²æŸ“åŸç† (IPC & Pipeline)</h1>  
  
    <div class="controls">  
        <button id="btn-start" onclick="startAnimation()">å¼€å§‹åŠ è½½ç½‘é¡µ</button>  
        <div id="status-bar">å‡†å¤‡å°±ç»ª</div>  
    </div>  
  
    <div class="stage">  
        <svg>  
            <!-- Browser to Network -->  
            <path d="M 175 90 L 175 300" class="connection"/>  
            <!-- Network to Renderer -->  
            <path d="M 300 350 L 400 150" class="connection"/>  
            <!-- Renderer to GPU -->  
            <path d="M 675 330 L 675 450" class="connection"/>  
        </svg>  
  
        <!-- 1. æµè§ˆå™¨è¿›ç¨‹ (æ§åˆ¶ä¸­å¿ƒ) -->  
        <div class="process-box" id="browser-process">  
            <div class="process-title" style="color: #0984e3;">Browser Process (ä¸»æ§)</div>  
            <div class="component ui-thread" id="comp-ui">UI Thread (åœ°å€æ /æ ‡ç­¾)</div>  
            <div class="component storage" id="comp-storage">Storage / Cookies</div>  
        </div>  
  
        <!-- 2. ç½‘ç»œæœåŠ¡ (Network Service) -->  
        <div class="process-box" id="network-service">  
            <div class="process-title" style="color: #e17055;">Network Service</div>  
            <div class="component" style="width: 100%; height: 100%; background: transparent;">HTTP / DNS / SSL</div>  
        </div>  
  
        <!-- 3. æ¸²æŸ“è¿›ç¨‹ (æ ¸å¿ƒ) -->  
        <div class="process-box" id="renderer-process">  
            <div class="process-title" style="color: #00b894;">Renderer Process (æ²™ç®±)</div>  
              
            <!-- ä¸»çº¿ç¨‹ -->  
            <div class="component main-thread">  
                <div style="position:absolute; top:-20px; left:10px; font-weight:bold; color:#00b894;">Main Thread</div>  
                  
                <div class="pipeline-node" id="node-html"><span>ğŸ“„</span>Parsing<br>DOM Tree</div>  
                <div class="pipeline-node" id="node-style"><span>ğŸ¨</span>Style<br>Recalc</div>  
                <div class="pipeline-node" id="node-layout"><span>ğŸ“</span>Layout<br>Box Tree</div>  
                <div class="pipeline-node" id="node-paint"><span>ğŸ–Œï¸</span>Paint<br>Record</div>  
                <div class="pipeline-node" id="node-layer"><span>ğŸ°</span>Layer<br>Composite</div>  
            </div>  
  
            <!-- åˆæˆçº¿ç¨‹ -->  
            <div class="component compositor-thread" id="comp-compositor">  
                Compositor Thread<br>(åˆ†å— Tiling)  
            </div>  
              
            <!-- å…‰æ …åŒ–çº¿ç¨‹ -->  
            <div class="component raster-thread" id="comp-raster">  
                Raster Threads<br>(å…‰æ …åŒ–)  
            </div>  
        </div>  
  
        <!-- 4. GPU è¿›ç¨‹ -->  
        <div class="process-box" id="gpu-process">  
            <div class="process-title" style="color: #6c5ce7;">GPU Process</div>  
            <div class="component" style="width: 100%; height: 100%; background: transparent;" id="comp-gpu">  
                OpenGL / Skia / DrawQuad -> Screen  
            </div>  
        </div>  
          
        <!-- åŠ¨ç”»ç”¨çš„å°çƒå®¹å™¨ -->  
        <div id="anim-layer"></div>  
    </div>  
  
    <script>  
        const statusEl = document.getElementById('status-bar');  
        const btnEl = document.getElementById('btn-start');  
        const animLayer = document.getElementById('anim-layer');  
  
        // è¾…åŠ©ï¼šæš‚åœ  
        const sleep = (ms) => new Promise(r => setTimeout(r, ms));  
  
        // è¾…åŠ©ï¼šé«˜äº®ç»„ä»¶  
        async function highlight(id, duration = 1000) {  
            const el = document.getElementById(id);  
            if (!el) return;  
            el.classList.add('active-component');  
            if (duration > 0) {  
                await sleep(duration);  
                el.classList.remove('active-component');  
            }  
        }  
  
        // è¾…åŠ©ï¼šç§»åŠ¨æ•°æ®åŒ…  
        async function movePacket(className, startX, startY, endX, endY, duration) {  
            const p = document.createElement('div');  
            p.className = 'packet ' + className;  
            p.style.left = startX + 'px';  
            p.style.top = startY + 'px';  
            p.style.opacity = 1;  
            animLayer.appendChild(p);  
  
            // å¼ºåˆ¶é‡ç»˜  
            p.getBoundingClientRect();  
  
            p.style.transition = `all ${duration}ms linear`;  
            p.style.left = endX + 'px';  
            p.style.top = endY + 'px';  
  
            await sleep(duration);  
            p.remove();  
        }  
  
        async function startAnimation() {  
            btnEl.disabled = true;  
              
            // Reset styles  
            document.querySelectorAll('.active-component').forEach(el => el.classList.remove('active-component'));  
            document.querySelectorAll('.pipeline-node').forEach(el => el.style.opacity = 0.3);  
  
            // --- æ­¥éª¤ 1: UI çº¿ç¨‹å¤„ç†è¾“å…¥ ---  
            statusEl.innerText = "1. Browser Process: ç”¨æˆ·è¾“å…¥ URL";  
            await highlight('comp-ui', 800);  
              
            // --- æ­¥éª¤ 2: å‘é€ç½‘ç»œè¯·æ±‚ ---  
            statusEl.innerText = "2. Network Service: DNS è§£æ & å»ºç«‹è¿æ¥";  
            // åŠ¨ç”»ï¼šBrowser -> Network  
            movePacket('url', 150, 70, 150, 350, 800);   
            await sleep(800);  
            await highlight('network-service', 1000);  
  
            // --- æ­¥éª¤ 3: æ¥æ”¶æ•°æ® & æäº¤å¯¼èˆª ---  
            statusEl.innerText = "3. IPC: å“åº”æ•°æ®æµå‘æ¸²æŸ“è¿›ç¨‹ (Commit Navigation)";  
            // åŠ¨ç”»ï¼šNetwork -> Renderer  
            movePacket('html', 150, 350, 450, 150, 1000);  
            await sleep(1000);  
  
            // --- æ­¥éª¤ 4: ä¸»çº¿ç¨‹æµæ°´çº¿ (The Pipeline) ---  
            statusEl.innerText = "4. Main Thread: è§£æ HTML -> æ„å»º DOM æ ‘";  
            highlight('node-html', 0); // ä¿æŒé«˜äº®  
            await sleep(600);  
  
            statusEl.innerText = "5. Main Thread: åŠ è½½ CSS -> è®¡ç®—æ ·å¼ (Recalc Style)";  
            highlight('node-style', 0);  
            await sleep(600);  
  
            statusEl.innerText = "6. Main Thread: å¸ƒå±€è®¡ç®— (Layout) - ç¡®å®šä½ç½®å¤§å°";  
            highlight('node-layout', 0);  
            await sleep(600);  
  
            statusEl.innerText = "7. Main Thread: ç»˜åˆ¶è®°å½• (Paint Record) - ç”ŸæˆæŒ‡ä»¤";  
            highlight('node-paint', 0);  
            await sleep(600);  
              
            statusEl.innerText = "8. Main Thread: åˆ†å±‚ (Layerize)";  
            highlight('node-layer', 0);  
            await sleep(800);  
  
            // æ¸…é™¤æµæ°´çº¿é«˜äº®  
            document.querySelectorAll('.pipeline-node').forEach(el => el.classList.remove('active-component'));  
  
            // --- æ­¥éª¤ 5: åˆæˆå™¨çº¿ç¨‹ ---  
            statusEl.innerText = "9. Compositor Thread: æ¥æ”¶å±‚æ ‘ï¼Œå°†å›¾å±‚åˆ‡åˆ†ä¸ºå›¾å— (Tiles)";  
            await highlight('comp-compositor', 1000);  
  
            // --- æ­¥éª¤ 6: å…‰æ …åŒ– (Raster) ---  
            statusEl.innerText = "10. Raster Thread: å°†å›¾å—å…‰æ …åŒ–ä¸ºä½å›¾ (é€šå¸¸ç”± GPU å®Œæˆ)";  
            // åŠ¨ç”»ï¼šCompositor -> Raster  
            movePacket('tile', 500, 300, 800, 300, 600);  
            await sleep(600);  
            await highlight('comp-raster', 800);  
  
            // --- æ­¥éª¤ 7: æäº¤ç»™ GPU æ˜¾ç¤º ---  
            statusEl.innerText = "11. IPC: DrawQuad å‘½ä»¤å‘é€ç»™ GPU è¿›ç¨‹";  
            // åŠ¨ç”»ï¼šRaster -> GPU  
            movePacket('tile', 800, 300, 800, 480, 800);  
            await sleep(800);  
  
            statusEl.innerText = "12. GPU Process: è°ƒç”¨ OpenGL/Skia å¹¶åœ¨å±å¹•ä¸Šç»˜åˆ¶ (Swap Buffers)";  
            await highlight('gpu-process', 1500);  
  
            statusEl.innerText = "âœ… é¡µé¢æ¸²æŸ“å®Œæˆ (Idle)";  
            btnEl.disabled = false;  
        }  
    </script>  
</body>  
</html>  
