<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>复古拍立得照片墙</title>  
    <style>  
        :root {  
            --bg-color: #f0f0f0;  
            --camera-body: #e0e0e0;  
            --camera-dark: #333;  
            --accent-color: #ff4757;  
        }  
  
        body {  
            margin: 0;  
            padding: 0;  
            width: 100vw;  
            height: 100vh;  
            background-color: #2c3e50;  
            background-image: radial-gradient(#34495e 15%, transparent 16%), radial-gradient(#34495e 15%, transparent 16%);  
            background-size: 60px 60px;  
            background-position: 0 0, 30px 30px;  
            overflow: hidden;  
            font-family: sans-serif;  
            user-select: none;  
        }  
  
        /* --- 照片墙区域 (其实就是整个 Body) --- */  
        #photo-wall {  
            width: 100%;  
            height: 100%;  
            position: absolute;  
            top: 0;  
            left: 0;  
            z-index: 1;  
        }  
  
        /* --- 拍立得相机容器 --- */  
        .camera-container {  
            position: fixed;  
            bottom: 30px;  
            left: 30px;  
            width: 220px;  
            height: 240px; /* 包含吐纸的高度 */  
            z-index: 100;  
            display: flex;  
            flex-direction: column;  
            justify-content: flex-end;  
            align-items: center;  
        }  
  
        /* --- 相机本体 --- */  
        .camera-body {  
            width: 200px;  
            height: 160px;  
            background: var(--camera-body);  
            border-radius: 20px;  
            position: relative;  
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);  
            z-index: 10; /* 保证相机在照片上面 */  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            border: 2px solid #bbb;  
        }  
  
        /* 彩虹条纹装饰 */  
        .stripe {  
            position: absolute;  
            top: 50%;  
            left: 0;  
            transform: translateY(-50%);  
            width: 100%;  
            height: 15px;  
            background: linear-gradient(to right,   
                #ffadad 0%, #ffadad 20%,   
                #ffd6a5 20%, #ffd6a5 40%,  
                #fdffb6 40%, #fdffb6 60%,  
                #caffbf 60%, #caffbf 80%,  
                #9bf6ff 80%, #9bf6ff 100%  
            );  
            z-index: 11;  
        }  
  
        /* 镜头/取景器 */  
        .lens-wrapper {  
            width: 100px;  
            height: 100px;  
            background: #222;  
            border-radius: 50%;  
            position: absolute;  
            top: 50%;  
            left: 50%;  
            transform: translate(-50%, -50%);  
            border: 4px solid #ccc;  
            z-index: 12;  
            overflow: hidden;  
            box-shadow: inset 0 0 10px #000;  
        }  
  
        video {  
            width: 100%;  
            height: 100%;  
            object-fit: cover;  
            transform: scaleX(-1); /* 镜像翻转 */  
        }  
  
        /* 快门按钮 */  
        .shutter-btn {  
            position: absolute;  
            top: 15px;  
            right: 20px;  
            width: 30px;  
            height: 30px;  
            background-color: var(--accent-color);  
            border-radius: 50%;  
            border: 2px solid #fff;  
            cursor: pointer;  
            z-index: 13;  
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);  
            transition: transform 0.1s;  
        }  
  
        .shutter-btn:active {  
            transform: scale(0.9);  
        }  
  
        /* 出纸口 (在相机顶部背后) */  
        .slot {  
            position: absolute;  
            top: 0px;  
            left: 15px;  
            width: 170px;  
            height: 10px;  
            background: #222;  
            z-index: 9;  
        }  
  
        /* --- 照片样式 --- */  
        .photo {  
            width: 140px;  
            height: 170px;  
            background: #fff;  
            padding: 10px 10px 40px 10px; /* 底部留白多一点 */  
            box-sizing: border-box;  
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);  
            position: absolute;   
            /* 初始在相机内部 */  
            bottom: 30px; /* 相机的高度底部 */  
            left: 50%;  
            transform: translateX(-50%);  
            z-index: 5; /* 比相机低，比背景高 */  
            transition: filter 4s ease-in-out; /* 显影动画 */  
            cursor: grab;  
            display: flex;  
            justify-content: center;  
            align-items: center;  
        }  
  
        .photo canvas {  
            width: 100%;  
            height: 100%;  
            background: #000;  
            object-fit: cover;  
        }  
  
        /* 显影过程的滤镜类 */  
        .developing {  
            filter: blur(10px) grayscale(100%) brightness(1.2);  
        }  
          
        .developed {  
            filter: blur(0px) grayscale(0%) brightness(1);  
        }  
  
        /* 拖拽时的样式 */  
        .photo.dragging {  
            cursor: grabbing;  
            z-index: 1000; /* 拖拽时最上层 */  
            box-shadow: 10px 10px 20px rgba(0,0,0,0.4);  
            transition: none; /* 拖拽时移除动画延迟 */  
        }  
  
        /* 提示文字 */  
        .tooltip {  
            position: fixed;  
            bottom: 280px;  
            left: 50px;  
            color: white;  
            background: rgba(0,0,0,0.5);  
            padding: 5px 10px;  
            border-radius: 4px;  
            font-size: 12px;  
            pointer-events: none;  
            opacity: 0.8;  
        }  
    </style>  
</head>  
<body>  
  
    <!-- 提示 -->  
    <div class="tooltip">点击红色按钮拍照，等照片弹出后拖动到墙上</div>  
  
    <!-- 照片墙容器 -->  
    <div id="photo-wall"></div>  
  
    <!-- 相机组件 -->  
    <div class="camera-container" id="camera-container">  
        <!-- 照片会从这里生成 -->  
          
        <div class="camera-body">  
            <div class="stripe"></div>  
            <button class="shutter-btn" id="shutter"></button>  
            <div class="lens-wrapper">  
                <video id="video" autoplay playsinline muted></video>  
            </div>  
            <!-- 装饰用的闪光灯 -->  
            <div style="position:absolute; top:15px; left:20px; width:40px; height:20px; background:#444; border-radius:4px;"></div>  
        </div>  
        <!-- 这是一个视觉上的挡板，让照片看起来是从相机里出来的 -->  
    </div>  
  
    <script>  
        const video = document.getElementById('video');  
        const shutterBtn = document.getElementById('shutter');  
        const cameraContainer = document.getElementById('camera-container');  
        const photoWall = document.getElementById('photo-wall');  
  
        // 1. 初始化摄像头  
        async function initCamera() {  
            try {  
                const stream = await navigator.mediaDevices.getUserMedia({   
                    video: {   
                        facingMode: "user",  
                        width: { ideal: 640 },  
                        height: { ideal: 640 }  
                    },   
                    audio: false   
                });  
                video.srcObject = stream;  
            } catch (err) {  
                console.error("摄像头访问失败:", err);  
                alert("无法访问摄像头，请确保允许权限或使用HTTPS/Localhost环境。");  
            }  
        }  
  
        // 2. 拍照功能  
        shutterBtn.addEventListener('click', takePhoto);  
  
        function takePhoto() {  
            // 简单的闪光效果  
            const flash = document.createElement('div');  
            flash.style.position = 'fixed';  
            flash.style.top = 0; flash.style.left = 0; flash.style.width = '100%'; flash.style.height = '100%';  
            flash.style.background = 'white';  
            flash.style.zIndex = 200;  
            flash.style.opacity = 1;  
            flash.style.transition = 'opacity 0.2s';  
            document.body.appendChild(flash);  
            setTimeout(() => flash.style.opacity = 0, 50);  
            setTimeout(() => flash.remove(), 250);  
  
            // 创建 Canvas 并绘制当前帧  
            const canvas = document.createElement('canvas');  
            canvas.width = 300;  
            canvas.height = 300; // 正方形拍立得  
            const ctx = canvas.getContext('2d');  
              
            // 镜像绘制  
            ctx.translate(canvas.width, 0);  
            ctx.scale(-1, 1);  
            // 裁剪视频中间部分以适应正方形  
            const videoSize = Math.min(video.videoWidth, video.videoHeight);  
            const startX = (video.videoWidth - videoSize) / 2;  
            const startY = (video.videoHeight - videoSize) / 2;  
              
            ctx.drawImage(video, startX, startY, videoSize, videoSize, 0, 0, canvas.width, canvas.height);  
  
            // 创建照片 DOM  
            createPolaroid(canvas);  
        }  
  
        // 3. 生成照片并执行弹出动画  
        function createPolaroid(canvas) {  
            const photoDiv = document.createElement('div');  
            photoDiv.className = 'photo developing';  
            photoDiv.appendChild(canvas);  
  
            // 将照片添加到相机容器中 (位置在相机后面)  
            cameraContainer.insertBefore(photoDiv, cameraContainer.firstChild);  
  
            // 强制重绘以确保初始状态被应用  
            photoDiv.offsetHeight;   
  
            // 动画：向上弹出  
            // 初始 top 是由 CSS bottom 控制的，我们需要用 translate 移动它  
            // 初始位置在相机底部内部，现在让他移动到相机上方  
            // 这里的动画使用 Web Animations API 或者简单的 CSS transition  
              
            // 设定动画关键帧：从被遮挡 -> 弹出  
            const ejectAnimation = photoDiv.animate([  
                { transform: 'translateX(-50%) translateY(0)' },  
                { transform: 'translateX(-50%) translateY(-160px)' }  
            ], {  
                duration: 2000,  
                easing: 'cubic-bezier(0.25, 1, 0.5, 1)',  
                fill: 'forwards'  
            });  
  
            // 显影效果：模糊变清晰  
            setTimeout(() => {  
                photoDiv.classList.remove('developing');  
                photoDiv.classList.add('developed');  
            }, 500); // 弹出一点点后开始显影  
  
            // 4. 绑定拖拽事件  
            makeDraggable(photoDiv);  
        }  
  
        // 5. 拖拽逻辑 (Drag and Drop)  
        function makeDraggable(element) {  
            let isDragging = false;  
            let startX, startY;  
            let initialLeft, initialTop;  
  
            element.addEventListener('mousedown', startDrag);  
            element.addEventListener('touchstart', startDrag, {passive: false});  
  
            function startDrag(e) {  
                // 如果还在动画中，也可以拖拽，但最好等弹出来  
                isDragging = true;  
                element.classList.add('dragging');  
  
                // 获取鼠标/手指位置  
                const clientX = e.clientX || e.touches[0].clientX;  
                const clientY = e.clientY || e.touches[0].clientY;  
  
                // 获取元素当前的屏幕坐标  
                const rect = element.getBoundingClientRect();  
                  
                // 关键步骤：将元素从 camera-container 移动到 body (photo-wall)  
                // 这样它就不再受限于相机的相对定位，可以全屏拖动  
                if (element.parentNode !== document.body) {  
                    element.style.position = 'absolute';  
                    element.style.left = rect.left + 'px';  
                    element.style.top = rect.top + 'px';  
                    element.style.bottom = 'auto';  
                    element.style.transform = 'none'; // 移除之前的居中变换  
                    // 添加随机旋转角度，增加自然感  
                    const randomAngle = (Math.random() - 0.5) * 20; // -10 到 10度  
                    element.style.transform = `rotate(${randomAngle}deg)`;  
                      
                    document.body.appendChild(element);  
                }  
  
                startX = clientX;  
                startY = clientY;  
                  
                // 获取当前的绝对位置  
                initialLeft = parseFloat(element.style.left);  
                initialTop = parseFloat(element.style.top);  
  
                document.addEventListener('mousemove', drag);  
                document.addEventListener('touchmove', drag, {passive: false});  
                document.addEventListener('mouseup', stopDrag);  
                document.addEventListener('touchend', stopDrag);  
            }  
  
            function drag(e) {  
                if (!isDragging) return;  
                e.preventDefault(); // 防止手机端滚动  
  
                const clientX = e.clientX || e.touches[0].clientX;  
                const clientY = e.clientY || e.touches[0].clientY;  
  
                const dx = clientX - startX;  
                const dy = clientY - startY;  
  
                element.style.left = `${initialLeft + dx}px`;  
                element.style.top = `${initialTop + dy}px`;  
            }  
  
            function stopDrag() {  
                isDragging = false;  
                element.classList.remove('dragging');  
                document.removeEventListener('mousemove', drag);  
                document.removeEventListener('touchmove', drag);  
                document.removeEventListener('mouseup', stopDrag);  
                document.removeEventListener('touchend', stopDrag);  
            }  
        }  
  
        // 启动  
        initCamera();  
  
    </script>  
</body>  
</html>  
