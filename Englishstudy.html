<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>è‹±è¯­éŸ³æ ‡æ•™ç»ƒ (å¸¦å‘éŸ³æç¤ºç‰ˆ)</title>  
    <style>  
        :root {  
            --primary: #4a90e2;  
            --secondary: #50e3c2;  
            --accent: #ff6b6b;  
            --bg: #f4f7f6;  
            --card-bg: #ffffff;  
            --text: #333;  
        }  
  
        body {  
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
            background-color: var(--bg);  
            color: var(--text);  
            margin: 0;  
            padding: 0;  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            min-height: 100vh;  
        }  
  
        header {  
            background: linear-gradient(135deg, var(--primary), var(--secondary));  
            width: 100%;  
            padding: 20px 0;  
            text-align: center;  
            color: white;  
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);  
        }  
  
        h1 { margin: 0; font-size: 1.6rem; }  
        p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }  
  
        /* Navigation */  
        .nav-tabs {  
            display: flex;  
            justify-content: center;  
            gap: 10px;  
            margin-top: 20px;  
            flex-wrap: wrap;  
        }  
  
        .nav-btn {  
            border: none;  
            background: white;  
            padding: 10px 20px;  
            border-radius: 25px;  
            cursor: pointer;  
            font-size: 0.95rem;  
            font-weight: bold;  
            color: #777;  
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);  
            transition: all 0.3s;  
        }  
  
        .nav-btn.active {  
            background-color: var(--primary);  
            color: white;  
            transform: scale(1.05);  
        }  
  
        /* Container */  
        .container {  
            width: 90%;  
            max-width: 1100px;  
            margin: 20px auto;  
            padding-bottom: 50px;  
        }  
  
        .view-section { display: none; animation: fadeIn 0.5s; }  
        .view-section.active { display: block; }  
  
        @keyframes fadeIn {  
            from { opacity: 0; transform: translateY(10px); }  
            to { opacity: 1; transform: translateY(0); }  
        }  
  
        /* Learn Grid Styles */  
        .grid {  
            display: grid;  
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));  
            gap: 15px;  
            margin-top: 15px;  
        }  
        .card {  
            background: var(--card-bg);  
            border-radius: 12px;  
            padding: 15px;  
            text-align: center;  
            cursor: pointer;  
            border: 2px solid transparent;  
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);  
            transition: transform 0.2s;  
            display: flex;  
            flex-direction: column;  
            justify-content: space-between; /* è®©å†…å®¹ä¸Šä¸‹åˆ†å¸ƒ */  
            min-height: 160px;  
        }  
        .card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }  
        .card.playing { border-color: var(--secondary); background-color: #f0fffa; }  
          
        .ipa-symbol {   
            font-size: 1.8rem;   
            font-weight: bold;   
            margin-bottom: 8px;   
            font-family: sans-serif;   
            color: var(--primary);   
        }  
          
        .word-container {  
            display: flex;  
            flex-direction: column;  
            gap: 4px;  
            flex-grow: 1;  
        }  
  
        .example-word {   
            font-size: 0.9rem;   
            color: #333;   
            background: #f0f2f5;   
            padding: 4px 8px;   
            border-radius: 4px;   
        }  
  
        /* æ–°å¢ï¼šå‘éŸ³æç¤ºæ ·å¼ */  
        .desc-text {  
            font-size: 0.75rem;  
            color: #888;  
            margin-top: 10px;  
            padding-top: 8px;  
            border-top: 1px dashed #eee;  
            font-style: italic;  
        }  
          
        .category-title { margin-top: 25px; border-left: 4px solid var(--primary); padding-left: 10px; font-weight: bold; color: #555; }  
  
        /* Quiz & Speak Containers */  
        .mode-container {  
            background: white;  
            padding: 30px;  
            border-radius: 15px;  
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);  
            text-align: center;  
            max-width: 500px;  
            margin: 0 auto;  
        }  
  
        /* Quiz Specific */  
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }  
        .option-btn { padding: 15px; background: #f8f9fa; border: 2px solid #eee; border-radius: 8px; font-size: 1.1rem; cursor: pointer; }  
        .option-btn.correct { background: #d4edda; border-color: #28a745; color: #155724; }  
        .option-btn.wrong { background: #f8d7da; border-color: #dc3545; color: #721c24; }  
  
        /* Speaking Mode Specific */  
        .speak-target-box {  
            margin: 20px 0;  
            padding: 20px;  
            background: #f8f9fa;  
            border-radius: 10px;  
            border: 2px dashed #ccc;  
        }  
        .big-ipa { font-size: 3rem; color: var(--primary); display: block; }  
        .big-word { font-size: 2rem; color: #333; font-weight: bold; margin-top: 10px; display: block; }  
          
        .mic-btn {  
            width: 80px;  
            height: 80px;  
            border-radius: 50%;  
            border: none;  
            background: var(--primary);  
            color: white;  
            font-size: 2rem;  
            cursor: pointer;  
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);  
            transition: all 0.2s;  
            margin: 20px auto;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
        }  
        .mic-btn:active { transform: scale(0.95); }  
        .mic-btn.listening {  
            background: var(--accent);  
            animation: pulse 1.5s infinite;  
        }  
        .mic-status { height: 20px; font-size: 0.9rem; color: #888; margin-bottom: 10px; }  
  
        @keyframes pulse {  
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }  
            70% { box-shadow: 0 0 0 20px rgba(255, 107, 107, 0); }  
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }  
        }  
  
        .action-btn {  
            padding: 10px 30px;  
            background: var(--primary);  
            color: white;  
            border: none;  
            border-radius: 25px;  
            cursor: pointer;  
            margin-top: 15px;  
            font-size: 1rem;  
        }  
          
        .play-sound-btn {  
            background: none; border: 1px solid #ccc; border-radius: 20px;  
            padding: 5px 15px; cursor: pointer; margin: 10px 0; font-size: 0.9rem;  
        }  
        .play-sound-btn:hover { background: #eee; }  
  
    </style>  
</head>  
<body>  
  
    <header>  
        <h1>å…¨èƒ½è‹±è¯­éŸ³æ ‡æ•™ç»ƒ</h1>  
        <p>ç‚¹å‡»å¡ç‰‡æœ—è¯» | åº•éƒ¨æŸ¥çœ‹å‘éŸ³æŠ€å·§</p>  
    </header>  
  
    <div class="nav-tabs">  
        <button class="nav-btn active" onclick="switchTab('learn')">å­¦ä¹ æ¨¡å¼</button>  
        <button class="nav-btn" onclick="switchTab('quiz')">å¬éŸ³æµ‹è¯•</button>  
        <button class="nav-btn" onclick="switchTab('speak')">å£è¯­è·Ÿè¯»</button>  
    </div>  
  
    <div class="container">  
          
        <!-- 1. å­¦ä¹ æ¨¡å¼ -->  
        <div id="learn-section" class="view-section active"></div>  
  
        <!-- 2. å¬éŸ³æµ‹è¯•æ¨¡å¼ -->  
        <div id="quiz-section" class="view-section">  
            <div class="mode-container">  
                <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 10px;">  
                    å¾—åˆ†: <span id="score">0</span>  
                </div>  
                <p>å¬åˆ°çš„æ˜¯å“ªä¸ªéŸ³æ ‡çš„å•è¯ï¼Ÿ</p>  
                  
                <div style="margin: 20px 0;">  
                    <div class="big-ipa" id="q-ipa" style="font-size: 2.5rem;">/ ? /</div>  
                    <button class="play-sound-btn" onclick="playCurrentQuizSound()">ğŸ”Š å†å¬ä¸€ééŸ³æ ‡</button>  
                </div>  
  
                <div class="options-grid" id="options-area"></div>  
                <div id="quiz-feedback" style="height: 30px; margin-top: 15px; font-weight: bold;"></div>  
                <button class="action-btn" id="quiz-next-btn" style="display:none;" onclick="nextQuizQuestion()">ä¸‹ä¸€é¢˜</button>  
            </div>  
        </div>  
  
        <!-- 3. å£è¯­è·Ÿè¯»æ¨¡å¼ -->  
        <div id="speak-section" class="view-section">  
            <div class="mode-container">  
                <p>è¯·æŒ‰ä¸‹éº¦å…‹é£ï¼Œå¤§å£°è¯»å‡ºä¸‹æ–¹çš„å•è¯</p>  
                  
                <div class="speak-target-box">  
                    <span class="big-ipa" id="speak-ipa">/ i: /</span>  
                    <span class="big-word" id="speak-word">see</span>  
                    <button class="play-sound-btn" onclick="playTargetWord()">ğŸ”Š å¬ç¤ºèŒƒå‘éŸ³</button>  
                </div>  
  
                <div class="mic-status" id="mic-status">ç‚¹å‡»éº¦å…‹é£å¼€å§‹</div>  
  
                <button class="mic-btn" id="mic-btn" onmousedown="startListening()" onmouseup="stopListening()" ontouchstart="startListening()" ontouchend="stopListening()">  
                    ğŸ¤  
                </button>  
                <p style="font-size:0.8rem; color:#999;">(æŒ‰ä½è¯´è¯ï¼Œæ¾å¼€ç»“æŸ)</p>  
  
                <div id="speak-result" style="font-size: 1.2rem; font-weight: bold; margin-top: 20px; min-height: 30px;"></div>  
                <div id="speak-transcript" style="color:#888; font-style:italic; font-size:0.9rem;"></div>  
  
                <button class="action-btn" onclick="nextSpeakQuestion()">æ¢ä¸€ä¸ªè¯</button>  
            </div>  
        </div>  
    </div>  
  
    <script>  
        /* --- æ•°æ®æºï¼šå·²ä¼˜åŒ– desc æè¿° --- */  
        const ipaData = [  
            { symbol: "i:", phonic: "Eee", type: "vowel", sub: "é•¿å…ƒéŸ³", examples: ["see", "tea", "me"], desc: "å˜´è§’å‘ä¸¤è¾¹æ‹‰å¼€ï¼Œåƒå¾®ç¬‘çŠ¶ï¼Œå£°éŸ³é•¿" },  
            { symbol: "É‘:", phonic: "Ahhh", type: "vowel", sub: "é•¿å…ƒéŸ³", examples: ["car", "father", "art"], desc: "å˜´å·´å¼ å¤§ï¼Œåƒçœ‹ç‰™åŒ»æ—¶è¯´'å•Š'" },  
            { symbol: "É”:", phonic: "Orrr", type: "vowel", sub: "é•¿å…ƒéŸ³", examples: ["door", "four", "law"], desc: "åŒå”‡æ”¶åœ†ï¼Œå‘å‰çªå‡º" },  
            { symbol: "u:", phonic: "Oooo", type: "vowel", sub: "é•¿å…ƒéŸ³", examples: ["blue", "food", "shoe"], desc: "å˜´å”‡æ’…èµ·ï¼Œåƒå¹å£å“¨ï¼Œå£°éŸ³é•¿" },  
            { symbol: "Éœ:", phonic: "Urrr", type: "vowel", sub: "é•¿å…ƒéŸ³", examples: ["girl", "bird", "turn"], desc: "ç‰™åºŠå¾®å¼€ï¼ŒèˆŒä¸­éƒ¨æŠ¬èµ·" },  
            { symbol: "Éª", phonic: "ih", type: "vowel", sub: "çŸ­å…ƒéŸ³", examples: ["sit", "pig", "big"], desc: "çŸ­ä¿ƒæœ‰åŠ›ï¼Œå˜´å”‡å¾®å¼€" },  
            { symbol: "e", phonic: "eh", type: "vowel", sub: "çŸ­å…ƒéŸ³", examples: ["bed", "pen", "hen"], desc: "å˜´è§’å¾®å¼€ï¼Œä¸Šä¸‹é½¿é—´å®¹ä¸€æŒ‡" },  
            { symbol: "Ã¦", phonic: "a", type: "vowel", sub: "çŸ­å…ƒéŸ³", examples: ["cat", "bad", "hat"], desc: "å˜´å¼ å¤§ï¼Œä¸Šä¸‹é½¿é—´å®¹ä¸¤æŒ‡" },  
            { symbol: "É’", phonic: "o", type: "vowel", sub: "çŸ­å…ƒéŸ³", examples: ["hot", "box", "dog"], desc: "å˜´å¼ å¤§åœ†ï¼Œå‘éŸ³çŸ­ä¿ƒ" },  
            { symbol: "ÊŠ", phonic: "uh", type: "vowel", sub: "çŸ­å…ƒéŸ³", examples: ["book", "look", "put"], desc: "åŒå”‡æ”¶åœ†ï¼Œè‚Œè‚‰æ”¾æ¾" },  
            { symbol: "ÊŒ", phonic: "uh", type: "vowel", sub: "çŸ­å…ƒéŸ³", examples: ["cup", "bus", "sun"], desc: "å˜´å¾®å¼ ï¼Œä¸­éƒ¨å¿«é€Ÿå‘éŸ³" },  
            { symbol: "É™", phonic: "uh", type: "vowel", sub: "çŸ­å…ƒéŸ³", examples: ["about", "sofa", "ago"], desc: "å˜´å”‡è‡ªç„¶æ”¾æ¾ï¼Œè½»è½»ä¸€å£°" },  
            { symbol: "eÉª", phonic: "Ay", type: "vowel", sub: "åŒå…ƒéŸ³", examples: ["day", "cake", "say"], desc: "ä»eæ»‘å‘iï¼Œåƒå­—æ¯Açš„å‘éŸ³" },  
            { symbol: "aÉª", phonic: "Eye", type: "vowel", sub: "åŒå…ƒéŸ³", examples: ["my", "fly", "ice"], desc: "ä»aæ»‘å‘iï¼Œåƒ'çˆ±'" },  
            { symbol: "É”Éª", phonic: "Oy", type: "vowel", sub: "åŒå…ƒéŸ³", examples: ["boy", "toy", "oil"], desc: "ä»oæ»‘å‘i" },  
            { symbol: "aÊŠ", phonic: "Ow", type: "vowel", sub: "åŒå…ƒéŸ³", examples: ["now", "cow", "out"], desc: "ä»aæ»‘å‘uï¼Œåƒè¢«è¸©äº†è„š" },  
            { symbol: "É™ÊŠ", phonic: "Oh", type: "vowel", sub: "åŒå…ƒéŸ³", examples: ["go", "no", "old"], desc: "ä»É™æ»‘å‘uï¼Œåƒå­—æ¯O" },  
            { symbol: "p", phonic: "Puh", type: "consonant", sub: "æ¸…è¾…éŸ³", examples: ["pen", "pig", "top"], desc: "åŒå”‡ç´§é—­ç„¶åçˆ†ç ´ï¼Œå£°å¸¦ä¸éœ‡" },  
            { symbol: "b", phonic: "Buh", type: "consonant", sub: "æµŠè¾…éŸ³", examples: ["bat", "big", "bus"], desc: "åŒå”‡ç´§é—­ç„¶åçˆ†ç ´ï¼Œå£°å¸¦éœ‡åŠ¨" },  
            { symbol: "t", phonic: "Tuh", type: "consonant", sub: "æ¸…è¾…éŸ³", examples: ["tea", "ten", "top"], desc: "èˆŒå°–æŠµä¸Šé½¿é¾ˆçˆ†ç ´ï¼Œå£°å¸¦ä¸éœ‡" },  
            { symbol: "d", phonic: "Duh", type: "consonant", sub: "æµŠè¾…éŸ³", examples: ["dog", "dad", "day"], desc: "èˆŒå°–æŠµä¸Šé½¿é¾ˆçˆ†ç ´ï¼Œå£°å¸¦éœ‡åŠ¨" },  
            { symbol: "s", phonic: "Sss", type: "consonant", sub: "æ¸…è¾…éŸ³", examples: ["see", "sit", "sun"], desc: "ä¸Šä¸‹é½¿é—­åˆï¼Œæ°”æµæ‘©æ“¦ï¼Œåƒè›‡" },  
            { symbol: "z", phonic: "Zzz", type: "consonant", sub: "æµŠè¾…éŸ³", examples: ["zoo", "zip", "zero"], desc: "åƒèœœèœ‚é£èˆçš„å£°éŸ³" },  
            { symbol: "m", phonic: "Mmm", type: "consonant", sub: "é¼»éŸ³", examples: ["me", "map", "man"], desc: "åŒå”‡é—­åˆï¼Œæ°”æµä»é¼»å‡º" },  
            { symbol: "n", phonic: "Nnn", type: "consonant", sub: "é¼»éŸ³", examples: ["no", "nine", "net"], desc: "èˆŒå°–æŠµä¸Šé½¿é¾ˆï¼Œæ°”æµä»é¼»å‡º" }  
        ];  
  
        // --- å…¨å±€å˜é‡ ---  
        let currentTimeout = null;  
        let currentQuizItem = null;  
        let currentSpeakItem = null;  
        let currentSpeakWord = "";  
        let recognition = null;  
  
        // --- åˆå§‹åŒ– ---  
        window.onload = function() {  
            renderLearning();  
            initSpeechRecognition();  
        };  
  
        function switchTab(tab) {  
            window.speechSynthesis.cancel(); // åœæ­¢æ‰€æœ‰å£°éŸ³  
              
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));  
            document.getElementById(tab + '-section').classList.add('active');  
              
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));  
            event.target.classList.add('active');  
  
            if(tab === 'quiz') nextQuizQuestion();  
            if(tab === 'speak') nextSpeakQuestion();  
        }  
  
        /* ================= 1. å­¦ä¹ æ¨¡å¼é€»è¾‘ (åŒ…å«å‘éŸ³æç¤º) ================= */  
        function renderLearning() {  
            const container = document.getElementById('learn-section');  
            const groups = {};  
            ipaData.forEach(item => {  
                const key = `$${item.type === 'vowel' ? 'å…ƒéŸ³' : 'è¾…éŸ³'} - $${item.sub}`;  
                if (!groups[key]) groups[key] = [];  
                groups[key].push(item);  
            });  
  
            for (const [groupName, items] of Object.entries(groups)) {  
                const title = document.createElement('div');  
                title.className = 'category-title';  
                title.innerText = groupName;  
                container.appendChild(title);  
  
                const grid = document.createElement('div');  
                grid.className = 'grid';  
  
                items.forEach(item => {  
                    const card = document.createElement('div');  
                    card.className = 'card';  
                    card.onclick = function() { playSoundSequence(item, this); };  
                      
                    // æ„å»ºå•è¯HTML  
                    let wordsHtml = "";  
                    item.examples.forEach(word => {  
                        wordsHtml += `<span class="example-word">${word}</span>`;  
                    });  
                      
                    // æ„å»ºå¡ç‰‡HTMLï¼ŒåŠ å…¥äº† desc-text  
                    card.innerHTML = `  
                        <div class="ipa-symbol">/${item.symbol}/</div>  
                        <div class="word-container">  
                            ${wordsHtml}  
                        </div>  
                        <div class="desc-text">${item.desc}</div>  
                    `;  
                      
                    grid.appendChild(card);  
                });  
                container.appendChild(grid);  
            }  
        }  
  
        function playSoundSequence(item, cardEl) {  
            window.speechSynthesis.cancel();  
            if (currentTimeout) clearTimeout(currentTimeout);  
            document.querySelectorAll('.card').forEach(c => c.classList.remove('playing'));  
            cardEl.classList.add('playing');  
  
            const u1 = new SpeechSynthesisUtterance(item.phonic);  
            u1.rate = 0.8; u1.lang = 'en-US';  
  
            const u2 = new SpeechSynthesisUtterance(item.examples.join('. '));  
            u2.rate = 0.8; u2.lang = 'en-US';  
            u2.onend = () => cardEl.classList.remove('playing');  
  
            u1.onend = () => {  
                currentTimeout = setTimeout(() => window.speechSynthesis.speak(u2), 500);  
            };  
            window.speechSynthesis.speak(u1);  
        }  
  
        /* ================= 2. å¬éŸ³æµ‹è¯•é€»è¾‘ ================= */  
        let quizScore = 0;  
  
        function nextQuizQuestion() {  
            document.getElementById('quiz-feedback').innerText = '';  
            document.getElementById('quiz-next-btn').style.display = 'none';  
              
            // éšæœºé€‰ä¸€ä¸ª  
            currentQuizItem = ipaData[Math.floor(Math.random() * ipaData.length)];  
              
            // æ˜¾ç¤ºé¢˜ç›®  
            document.getElementById('q-ipa').innerText = `/${currentQuizItem.symbol}/`;  
              
            // ç”Ÿæˆé€‰é¡¹  
            const correctWord = currentQuizItem.examples[Math.floor(Math.random() * currentQuizItem.examples.length)];  
            const options = [correctWord];  
            while (options.length < 4) {  
                const rItem = ipaData[Math.floor(Math.random() * ipaData.length)];  
                if (rItem.symbol !== currentQuizItem.symbol) {  
                    const rWord = rItem.examples[Math.floor(Math.random() * rItem.examples.length)];  
                    if (!options.includes(rWord)) options.push(rWord);  
                }  
            }  
            options.sort(() => Math.random() - 0.5);  
  
            const optArea = document.getElementById('options-area');  
            optArea.innerHTML = '';  
            options.forEach(word => {  
                const btn = document.createElement('button');  
                btn.className = 'option-btn';  
                btn.innerText = word;  
                btn.onclick = () => checkQuizAnswer(btn, word, correctWord);  
                optArea.appendChild(btn);  
            });  
  
            // è‡ªåŠ¨æ’­æ”¾éŸ³æ ‡å£°éŸ³  
            setTimeout(() => playCurrentQuizSound(), 500);  
        }  
  
        function playCurrentQuizSound() {  
            if(!currentQuizItem) return;  
            window.speechSynthesis.cancel();  
            const u = new SpeechSynthesisUtterance(currentQuizItem.phonic);  
            u.lang = 'en-US'; u.rate = 0.8;  
            window.speechSynthesis.speak(u);  
        }  
  
        function checkQuizAnswer(btn, selected, correct) {  
            const btns = document.querySelectorAll('.option-btn');  
            btns.forEach(b => b.disabled = true);  
              
            const fb = document.getElementById('quiz-feedback');  
            if(selected === correct) {  
                btn.classList.add('correct');  
                quizScore += 10;  
                fb.innerText = "æ­£ç¡®! ğŸ‰";  
                fb.style.color = "green";  
                speakText("Correct");  
            } else {  
                btn.classList.add('wrong');  
                fb.innerText = `é”™è¯¯ï¼Œç­”æ¡ˆæ˜¯: ${correct}`;  
                fb.style.color = "red";  
                btns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });  
                speakText("Wrong");  
            }  
            document.getElementById('score').innerText = quizScore;  
            document.getElementById('quiz-next-btn').style.display = 'inline-block';  
        }  
  
        /* ================= 3. å£è¯­è·Ÿè¯»é€»è¾‘ ================= */  
          
        function initSpeechRecognition() {  
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;  
            if (SpeechRecognition) {  
                recognition = new SpeechRecognition();  
                recognition.lang = 'en-US';  
                recognition.interimResults = false;  
                recognition.maxAlternatives = 1;  
  
                recognition.onstart = () => {  
                    document.getElementById('mic-btn').classList.add('listening');  
                    document.getElementById('mic-status').innerText = "æ­£åœ¨è†å¬...";  
                };  
  
                recognition.onend = () => {  
                    document.getElementById('mic-btn').classList.remove('listening');  
                    document.getElementById('mic-status').innerText = "ç‚¹å‡»éº¦å…‹é£å¼€å§‹";  
                };  
  
                recognition.onresult = (event) => {  
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();  
                    document.getElementById('speak-transcript').innerText = `è¯†åˆ«åˆ°: "${transcript}"`;  
                    verifySpeech(transcript);  
                };  
  
                recognition.onerror = (event) => {  
                    document.getElementById('speak-result').innerText = "å¬ä¸æ¸…æ¥šï¼Œè¯·å†è¯•ä¸€æ¬¡";  
                    document.getElementById('speak-result').style.color = "orange";  
                };  
            } else {  
                document.getElementById('mic-btn').style.display = 'none';  
                document.getElementById('mic-status').innerText = "æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ« (æ¨èä½¿ç”¨ Chrome/Edge)";  
            }  
        }  
  
        function nextSpeakQuestion() {  
            document.getElementById('speak-result').innerText = "";  
            document.getElementById('speak-transcript').innerText = "";  
              
            currentSpeakItem = ipaData[Math.floor(Math.random() * ipaData.length)];  
            currentSpeakWord = currentSpeakItem.examples[Math.floor(Math.random() * currentSpeakItem.examples.length)];  
              
            document.getElementById('speak-ipa').innerText = `/${currentSpeakItem.symbol}/`;  
            document.getElementById('speak-word').innerText = currentSpeakWord;  
        }  
  
        function playTargetWord() {  
            speakText(currentSpeakWord);  
        }  
  
        function startListening() {  
            if(recognition) {  
                try { recognition.start(); } catch(e) {}  
            }  
        }  
          
        function stopListening() {  
            if(recognition) {  
                recognition.stop();  
            }  
        }  
  
        function verifySpeech(transcript) {  
            const cleanTranscript = transcript.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");  
            const cleanTarget = currentSpeakWord.toLowerCase();  
            const resBox = document.getElementById('speak-result');  
              
            if (cleanTranscript === cleanTarget) {  
                resBox.innerText = "Perfect! å‘éŸ³å‡†ç¡® ğŸŒŸ";  
                resBox.style.color = "green";  
                speakText("Great job");  
            } else if (cleanTranscript.includes(cleanTarget)) {  
                resBox.innerText = "Good! å‘éŸ³é€šè¿‡ âœ…";  
                resBox.style.color = "#28a745";  
            } else {  
                resBox.innerText = "å‘éŸ³ä¸å¤ªå‡†ï¼Œè¯·å†è¯•ä¸€æ¬¡ âŒ";  
                resBox.style.color = "red";  
            }  
        }  
  
        function speakText(text) {  
            window.speechSynthesis.cancel();  
            const u = new SpeechSynthesisUtterance(text);  
            u.lang = 'en-US';  
            window.speechSynthesis.speak(u);  
        }  
    </script>  
</body>  
</html>  
